<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Caitlin M. Andrews" />

<meta name="date" content="2020-08-27" />

<title>Demonstration of netCDF functionality in rSW2analysis</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Demonstration of netCDF functionality in rSW2analysis</h1>
<h4 class="author">Caitlin M. Andrews</h4>
<h4 class="date">2020-08-27</h4>


<div id="TOC">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#input-data-format-and-structure">Input Data Format and Structure</a>
<ul>
<li><a href="#variable-data">Variable Data</a></li>
<li><a href="#location-data">Location Data</a></li>
<li><a href="#attribute-data">Attribute Data</a></li>
</ul></li>
<li><a href="#output-files-structure-naming-conventions">Output Files Structure Naming Conventions</a></li>
<li><a href="#create-netcdf-function-and-examples">Create netCDF Function and Examples</a>
<ul>
<li><a href="#example-1---create-a-3-dimension-netcdf-lat-long-time-from-gridded-data">Example 1 - Create a 3 dimension netCDF (lat, long, time) from gridded data</a></li>
<li><a href="#create-a-3-dimension-netcdf-lat-long-time-from-non-gridded-data">Create a 3 dimension netCDF (lat, long, time) from non-gridded data</a></li>
<li><a href="#create-a-4-dimension-netcdf-lt-lomg-time-depth-from-gridded-data">Create a 4 dimension netCDF (lt, lomg, time, depth) from gridded data</a></li>
</ul></li>
</ul>
</div>

<div id="overview" class="section level1">
<h1>Overview</h1>
<p>This vignette is an overview of how to use the functions in the rSW2analysis package to convert arrays of rSOILWAT2 and SOILWAT2 output data into netCDFs that adhere to <a href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.8/cf-conventions.html#_orthogonal_multidimensional_array_representation">CF conventions</a>.</p>
<p>Additionally, this document describes our standards and conventions in regards to naming, metadata, and netCDF structure.</p>
</div>
<div id="input-data-format-and-structure" class="section level1">
<h1>Input Data Format and Structure</h1>
<div id="variable-data" class="section level2">
<h2>Variable Data</h2>
<p>The netCDF functions in this package expect an array, in which each row represents data for a site. Columns represent one of three things:</p>
<ul>
<li>multiple different variables for one site</li>
<li>one variable with multiple measurements (time series)</li>
<li>one variable with multiple depth measurements</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>   <span class="co"># dummy data for 10 sites, 10 data points (could be 10 vars, 10 times, or 10 depths)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>   someData &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">7</span>, <span class="dv">30</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>   data1d &lt;-<span class="st"> </span><span class="kw">array</span>(someData, <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>   <span class="kw">str</span>(data1d)</span></code></pre></div>
<pre><code>##  num [1:10, 1:10] -14.14 15.74 -3.63 -3.14 17.67 ...</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>   <span class="kw">is.array</span>(data1d)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Additionally, it is possible to have data at multiple times <em>and</em> multiple depths. In this case, time should be organized by column, and multiple depths should be organized sequentially in third dimension, forming a 3d array.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>  <span class="co"># dummy data for 10 sites, 10 times, 3 depths.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>  data3d &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="dv">0</span>, <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">3</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>  data3d[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>someData</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>  data3d[,,<span class="dv">2</span>] &lt;-<span class="st"> </span>someData</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>  data3d[,,<span class="dv">3</span>] &lt;-<span class="st"> </span>someData</span></code></pre></div>
</div>
<div id="location-data" class="section level2">
<h2>Location Data</h2>
<p>Locations all need to be on the same coordinates reference system (CRS). Data can be either be organized on a regularly spaced grid (i.e. wall to wall simulations for a given area) or not (i.e. project data representing plot points in a park).</p>
<p>If the former, the coordinates need to be in order. If the later,</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>  <span class="co"># points on a regular spaced grid in the WGS84 CRS</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>  locationsGrid &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">X_WGS84 =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="op">-</span><span class="fl">124.5938</span>, <span class="dv">5</span>), <span class="kw">rep</span>(<span class="op">-</span><span class="fl">124.5312</span>, <span class="dv">5</span>)),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>                        <span class="dt">Y_WGS84 =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="fl">47.90625</span>, <span class="fl">47.96875</span>, <span class="fl">48.03125</span>, <span class="fl">48.09375</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>                                     <span class="fl">48.15625</span>), <span class="dv">2</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>   </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>  <span class="co"># irregularly spaced points in the WGS84 CRS</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>  <span class="co">#locationsRandom</span></span></code></pre></div>
</div>
<div id="attribute-data" class="section level2">
<h2>Attribute Data</h2>
<p>Attribute data pertains to the metadata contained in the netCDFs. NetCDFs are self-documenting and require metadata attributes, providing information necessary for interpreting the data.</p>
<p>Different attribute types include variable attributes, time attributes, depth attributes, and global attributes. The format of attributes is a named list. Each attribute list has a bare minimum of required fields. Endless other fields are optional and can be added by the user as they see fit.</p>
<div id="variable-attributes" class="section level3">
<h3>Variable Attributes</h3>
<p>A named list describing the variable data. The <em>name</em> and <em>units</em> fields are required.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>var_attributes &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>  <span class="dt">name =</span> <span class="st">&#39;WatYrWDD&#39;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>  <span class="dt">long_name =</span> <span class="st">&#39;Water Year Wet Degree Days&#39;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>  <span class="dt">units =</span> <span class="st">&#39;number of days&#39;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>)</span></code></pre></div>
</div>
<div id="time-attributes" class="section level3">
<h3>Time Attributes</h3>
<p>A named list describing the time dimension. The <em>name</em>, <em>units</em>, <em>calender</em>, and <em>vals</em> fields are required.</p>
<p>A common unit for netCDF is days since 1900. A full list of accepted time units can be found <a href="https://ncics.org/portfolio/other-resources/udunits2/">here</a>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>time_attributes &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>  <span class="dt">name =</span> <span class="st">&#39;time&#39;</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>  <span class="dt">units =</span> <span class="st">&#39;days since 1900-01-01&#39;</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>  <span class="dt">calendar =</span> <span class="st">&#39;standard&#39;</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>  <span class="dt">unlim =</span> <span class="ot">TRUE</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>  <span class="dt">vals =</span> <span class="kw">c</span>(<span class="dv">43554</span>, <span class="dv">43920</span>, <span class="dv">44285</span>, <span class="dv">44650</span>, <span class="dv">45015</span>, <span class="dv">45381</span>, <span class="dv">45746</span>, <span class="dv">46111</span>, <span class="dv">46476</span>, <span class="dv">46842</span>)<span class="co"># mid point of year</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>  )</span></code></pre></div>
</div>
<div id="vertical-depth-z-attributes" class="section level3">
<h3>Vertical (depth / Z) Attributes</h3>
<p>A named list describing the vertical (depth / Z) dimension. The <em>name</em>, <em>units</em>, and <em>vals</em> fields are required.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>vertical_attributes &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a>  <span class="dt">name =</span> <span class="st">&#39;depth&#39;</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>  <span class="dt">units =</span> <span class="st">&#39;cm&#39;</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>  <span class="dt">positive =</span> <span class="st">&#39;down&#39;</span>, <span class="co"># depth is down, height is up</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>  <span class="dt">vals =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">15</span>,<span class="dv">20</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>)</span></code></pre></div>
</div>
<div id="global-attributes" class="section level3">
<h3>Global Attributes</h3>
<p>A named list describing the global attributes of the netCDF. This is where you describe things like how the data was made, where the data was made, who the data was made by, what climate models were used to create the data, etc.</p>
<p>The <em>title</em>, <em>institution</em>, <em>description</em>, <em>source_id</em>, <em>realm</em>, <em>product</em>, and <em>contact</em> fields are required.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>global_attributes &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>    <span class="dt">title =</span> <span class="st">&quot;Project Name Annual Wet Degree Days&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>    <span class="dt">institution =</span> <span class="st">&#39;Southwest Biological Science Center, U.S. Geological Survey&#39;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>    <span class="dt">description =</span> <span class="st">&#39;methods on how this data was made&#39;</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>    <span class="dt">source =</span> <span class="kw">paste</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>      <span class="st">&quot;SOILWAT2 (v4.2.0);&quot;</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>      <span class="st">&quot;rSOILWAT2 (v2.3.2);&quot;</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>      <span class="st">&quot;rSFSW2 (v3.1.2)&quot;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>    ),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a>    <span class="dt">source_id =</span> <span class="st">&quot;SOILWAT2&quot;</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>    <span class="dt">realm =</span> <span class="st">&quot;land&quot;</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a>    <span class="dt">parent_mip_era =</span> <span class="st">&quot;CMIP5&quot;</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a>    <span class="dt">parent_experiment_id =</span> <span class="st">&quot;RCP45&quot;</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a>    <span class="dt">parent_source =</span> <span class="st">&quot;CanESM2&quot;</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a>    <span class="dt">parent_variant_label =</span> <span class="st">&quot;r1i1p1f1&quot;</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true"></a>    <span class="dt">product =</span> <span class="st">&quot;model-output&quot;</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true"></a>    <span class="dt">projection =</span> <span class="st">&#39;Geographic&#39;</span>,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true"></a>    <span class="dt">grid =</span> <span class="st">&#39;WGS84&#39;</span>,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true"></a>    <span class="dt">grid_label =</span> <span class="st">&quot;gn&quot;</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true"></a>    <span class="dt">nominal_resolution =</span> <span class="st">&quot;10 km&quot;</span>, <span class="co"># \code{\link{populate_netcdf_from_array}}</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true"></a>    <span class="dt">further_info_url =</span> <span class="st">&quot;https://github.com/DrylandEcology/&quot;</span>,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true"></a>    <span class="dt">contact =</span> <span class="st">&quot;you@email.com&quot;</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true"></a>    )</span></code></pre></div>
<div id="nominal-resolution" class="section level4">
<h4>Nominal resolution</h4>
<p>If the data is calculated and reported on a grid, CF convention calls for the field <em>nominal resolution</em> to be contained in the global attributes. The function <em>calculate_nominal_resolution</em> will calculate the nominal resolution of your gridded data for you. However, you need to provide a raster of the grid, the lat/long locations, and the area that each cell in the grid represents.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a> <span class="co"># grid &lt;- &#39;RasterbySiteID_AllWesternUS.tif&#39;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a><span class="co">#  sites &lt;- MasterIM[,c(2:3)]</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a><span class="co">#  cell_areas_km2 &lt;- rep(7, 127443)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a> <span class="co"># calculate_nominal_resolution(grid, locations, cell_areas_km2)</span></span></code></pre></div>
</div>
</div>
</div>
</div>
<div id="output-files-structure-naming-conventions" class="section level1">
<h1>Output Files Structure Naming Conventions</h1>
<p>File structure should be organized by: variableName / allFilesPerVariable. Each file will contain variable output for one time period and/or climate model.</p>
<p>The name for each file should be in the format as follows: <strong>var_LorA_timestep_Project_SOILWAT2_GCM_RCP_variantLabel_gn_startT_endT.nc</strong></p>
<p>where:</p>
<ul>
<li>var – Shorthand name for variable that is contained in files (i.e. ppt for precipitation, WDD for wet degree days)</li>
<li>LorA – Land (L) or atmospheric (A) data</li>
<li>timestep – The time-step of the data contained (i.e. the units of the time dimension (i.e. year, month)).</li>
<li>Project – Project Name (i.e. SEUG or RangeResil, etc.)</li>
<li>SOILWAT2 – Keep as is. Denotes that SOILWAT2 was used to generate these results</li>
<li>GCM – Name of the GCM climate data used to drive the SOILWAT2 model (i.e. IPSL5, CCSM2-1)</li>
<li>RCP – Name of which GCM used to drive the GCM (RCP4.5, RCP8.5)</li>
<li>variantLabel –Variant of the GCM used (i.e. r1i1p1f1)</li>
<li>gn</li>
<li>startT – lower time bound or start of the time period contained. Units should be the date (YearMonthDay, XXXXYYZZ).<br />
</li>
<li>endT – upper time bound or end of the time period contained. Units should be the date (YearMonthDay, XXXXYYZZ).</li>
</ul>
</div>
<div id="create-netcdf-function-and-examples" class="section level1">
<h1>Create netCDF Function and Examples</h1>
<p>The functions create_empty_netCDF_file and populate_netcdf_from_array will create and populate a netCDF from an array. The user defines the dimensions, attribtues, and locations in the functions’ arguments.</p>
<p>The two functions work in conjuction with one another. First, an empty netcdf is created. Then, it is filled with data.</p>
<div id="example-1---create-a-3-dimension-netcdf-lat-long-time-from-gridded-data" class="section level2">
<h2>Example 1 - Create a 3 dimension netCDF (lat, long, time) from gridded data</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>    <span class="kw">library</span>(rSW2analysis)</span></code></pre></div>
<pre><code>## Loading required package: rSW2utils</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a>    <span class="kw">library</span>(sp)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>    <span class="kw">library</span>(raster)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>    </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a>    <span class="co"># additional arguments</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>    </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a>    <span class="co">## locations</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a>    crs &lt;-<span class="st"> &#39;+init=epsg:4326&#39;</span> <span class="co"># the CRS</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a>    </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true"></a>    <span class="co">## time bounds</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true"></a>    annual_time_bounds &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">43737</span>, <span class="dv">44102</span>, <span class="dv">44103</span>, <span class="dv">44467</span>, <span class="dv">44468</span>, <span class="dv">44832</span>, <span class="dv">44833</span>, <span class="dv">45197</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true"></a>                   <span class="dv">45198</span>, <span class="dv">45563</span>, <span class="dv">45564</span>, <span class="dv">45928</span>, <span class="dv">45929</span>, <span class="dv">46293</span>, <span class="dv">46294</span>, <span class="dv">46658</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true"></a>                  <span class="dv">46659</span>, <span class="dv">47024</span>, <span class="dv">47025</span>, <span class="dv">47389</span>) <span class="co"># beginning and end of year days since 1900-01-01</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true"></a>    </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true"></a>    outFileName &lt;-<span class="st"> &#39;dummynetcdf.nc&#39;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true"></a>    </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true"></a>    <span class="co"># create</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true"></a>    <span class="kw">create_empty_netCDF_file</span>(</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true"></a>      <span class="dt">data =</span> data1d,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true"></a>      <span class="dt">has_T_timeAxis =</span> <span class="ot">TRUE</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true"></a>      <span class="dt">has_Z_verticalAxis =</span> <span class="ot">FALSE</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true"></a>      <span class="dt">time_bounds =</span> annual_time_bounds,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true"></a>      <span class="dt">vert_bounds =</span> <span class="ot">NULL</span>,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true"></a>      <span class="dt">var_attributes =</span> var_attributes,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true"></a>      <span class="dt">time_attributes  =</span> time_attributes,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true"></a>      <span class="dt">vertical_attributes =</span> <span class="ot">NULL</span>,</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true"></a>      <span class="dt">global_attributes =</span> global_attributes,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true"></a>      <span class="dt">isGridded =</span> <span class="ot">TRUE</span>,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true"></a>      <span class="dt">locations =</span> locationsGrid,</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true"></a>      <span class="dt">crs =</span> crs,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true"></a>      <span class="dt">file =</span> outFileName,</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true"></a>      <span class="dt">force_v4 =</span> <span class="ot">TRUE</span>,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true"></a>      <span class="dt">overwrite =</span> <span class="ot">TRUE</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true"></a>    )</span></code></pre></div>
<pre><code>## Loading required namespace: ncdf4</code></pre>
<pre><code>## Loading required namespace: rSFSW2</code></pre>
<pre><code>## The file has 5 variables and 4 dimensions</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a>    <span class="co"># populate</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a>    <span class="kw">populate_netcdf_from_array</span>( </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a>      <span class="dt">file =</span> outFileName, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a>      <span class="dt">data =</span> data1d,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>      var_names &lt;-<span class="st"> </span>var_attributes<span class="op">$</span>name,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a>      <span class="dt">has_T_timeAxis =</span> <span class="ot">TRUE</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>      <span class="dt">has_Z_verticalAxis =</span> <span class="ot">FALSE</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a>      <span class="dt">isGridded =</span> <span class="ot">TRUE</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a>      <span class="dt">locations =</span> locationsGrid,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true"></a>      <span class="dt">crs =</span> crs,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true"></a>      <span class="dt">force_v4 =</span> <span class="ot">TRUE</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true"></a>    )</span></code></pre></div>
<pre><code>## The dimensionality of variable WatYrWDD is 2, 5, 10</code></pre>
</div>
<div id="create-a-3-dimension-netcdf-lat-long-time-from-non-gridded-data" class="section level2">
<h2>Create a 3 dimension netCDF (lat, long, time) from non-gridded data</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="co"># to do</span></span></code></pre></div>
</div>
<div id="create-a-4-dimension-netcdf-lt-lomg-time-depth-from-gridded-data" class="section level2">
<h2>Create a 4 dimension netCDF (lt, lomg, time, depth) from gridded data</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a>depth_bounds &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">15</span>) <span class="co"># min and max of each depth </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a> <span class="kw">create_empty_netCDF_file</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a>      <span class="dt">data =</span> data3d,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a>      <span class="dt">has_T_timeAxis =</span> <span class="ot">TRUE</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a>      <span class="dt">has_Z_verticalAxis =</span> <span class="ot">TRUE</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true"></a>      <span class="dt">time_bounds =</span> annual_time_bounds,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true"></a>      <span class="dt">vert_bounds =</span> depth_bounds,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true"></a>      <span class="dt">var_attributes =</span> var_attributes,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true"></a>      <span class="dt">time_attributes  =</span> time_attributes,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true"></a>      <span class="dt">vertical_attributes =</span> vertical_attributes,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true"></a>      <span class="dt">global_attributes =</span> global_attributes,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true"></a>      <span class="dt">isGridded =</span> <span class="ot">TRUE</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true"></a>      <span class="dt">locations =</span> locationsGrid,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true"></a>      <span class="dt">crs =</span> crs,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true"></a>      <span class="dt">file =</span> outFileName,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true"></a>      <span class="dt">force_v4 =</span> <span class="ot">TRUE</span>,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true"></a>      <span class="dt">overwrite =</span> <span class="ot">TRUE</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true"></a>    )</span></code></pre></div>
<pre><code>## The file has 6 variables and 5 dimensions</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a>     <span class="co"># populate</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a>    <span class="kw">populate_netcdf_from_array</span>( </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a>      <span class="dt">file =</span> outFileName, </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a>      <span class="dt">data =</span> data3d,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true"></a>      var_names &lt;-<span class="st"> </span>var_attributes<span class="op">$</span>name,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true"></a>      <span class="dt">has_T_timeAxis =</span> <span class="ot">TRUE</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true"></a>      <span class="dt">has_Z_verticalAxis =</span> <span class="ot">TRUE</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true"></a>      <span class="dt">isGridded =</span> <span class="ot">TRUE</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true"></a>      <span class="dt">locations =</span> locationsGrid,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true"></a>      <span class="dt">crs =</span> crs,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true"></a>      <span class="dt">force_v4 =</span> <span class="ot">TRUE</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true"></a>    )</span></code></pre></div>
<pre><code>## The dimensionality of variable WatYrWDD is 2, 5, 10, 3</code></pre>
<pre><code>## Adding depth layer 1</code></pre>
<pre><code>## Adding depth layer 2</code></pre>
<pre><code>## Adding depth layer 3</code></pre>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
